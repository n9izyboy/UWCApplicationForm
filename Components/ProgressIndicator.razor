@* Progress Indicator Component *@

<div class="bg-white shadow-md rounded-lg p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
        <div>
            <h3 class="text-lg font-semibold text-uwc-navy">Application Progress</h3>
            <p class="text-sm text-gray-600">Section @(CurrentSection + 1) of @TotalSections</p>
        </div>
        <div class="text-right">
            <p class="text-2xl font-bold text-uwc-gold">@CompletionPercentage%</p>
            <p class="text-xs text-gray-600">Complete</p>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar mb-4">
        <div class="progress-bar-fill" style="width: @(CompletionPercentage)%"></div>
    </div>

    <!-- Progress Dots -->
    <div class="progress-dots">
        @for (int i = 0; i < TotalSections; i++)
        {
            var index = i;
            <button 
                class="@GetDotClass(index)"
                @onclick="() => OnSectionClick(index)"
                aria-label="Go to section @(index + 1)"
                title="@SectionNames[index]">
            </button>
        }
    </div>

    <!-- Section Names -->
    @if (ShowSectionNames)
    {
        <div class="mt-4 text-center">
            <p class="text-sm font-medium text-gray-700">@SectionNames[CurrentSection]</p>
        </div>
    }

    <!-- Auto-save indicator -->
    @if (!string.IsNullOrEmpty(LastSavedText))
    {
        <div class="mt-4 text-center">
            <p class="text-xs text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                @LastSavedText
            </p>
        </div>
    }
</div>

@code {
    [Parameter]
    public int CurrentSection { get; set; } = 0;

    [Parameter]
    public int TotalSections { get; set; } = 10;

    [Parameter]
    public int CompletionPercentage { get; set; } = 0;

    [Parameter]
    public string[] SectionNames { get; set; } = Array.Empty<string>();

    [Parameter]
    public bool[] CompletedSections { get; set; } = Array.Empty<bool>();

    [Parameter]
    public bool ShowSectionNames { get; set; } = true;

    [Parameter]
    public string LastSavedText { get; set; } = string.Empty;

    [Parameter]
    public EventCallback<int> OnSectionChanged { get; set; }

    private string GetDotClass(int index)
    {
        var baseClass = "progress-dot";
        
        if (index == CurrentSection)
        {
            return $"{baseClass} active";
        }
        
        if (CompletedSections.Length > index && CompletedSections[index])
        {
            return $"{baseClass} completed";
        }

        return baseClass;
    }

    private async Task OnSectionClick(int index)
    {
        if (OnSectionChanged.HasDelegate)
        {
            await OnSectionChanged.InvokeAsync(index);
        }
    }
}
