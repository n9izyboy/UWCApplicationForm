@* Floating Label Input Component *@

<div class="floating-label-group">
    <input 
        type="@InputType"
        id="@Id"
        class="@GetInputClass()"
        placeholder=" "
        value="@Value"
        @oninput="HandleInput"
        @onblur="HandleBlur"
        disabled="@Disabled"
        required="@Required" />
    
    <label for="@Id" class="floating-label">
        @Label
        @if (Required)
        {
            <span class="required-asterisk">*</span>
        }
    </label>

    @if (!string.IsNullOrEmpty(ValidationState))
    {
        <span class="validation-icon @(ValidationState == "valid" ? "valid" : "invalid")">
            @if (ValidationState == "valid")
            {
                <text>✓</text>
            }
            else
            {
                <text>✗</text>
            }
        </span>
    }

    @if (!string.IsNullOrEmpty(HelperText) && string.IsNullOrEmpty(ErrorMessage))
    {
        <p class="helper-text">@HelperText</p>
    }

    @if (!string.IsNullOrEmpty(ErrorMessage))
    {
        <p class="error-text">@ErrorMessage</p>
    }
</div>

@code {
    [Parameter]
    public string Id { get; set; } = Guid.NewGuid().ToString();

    [Parameter]
    public string Label { get; set; } = string.Empty;

    [Parameter]
    public string Value { get; set; } = string.Empty;

    [Parameter]
    public EventCallback<string> ValueChanged { get; set; }

    [Parameter]
    public string InputType { get; set; } = "text";

    [Parameter]
    public bool Required { get; set; } = false;

    [Parameter]
    public bool Disabled { get; set; } = false;

    [Parameter]
    public string HelperText { get; set; } = string.Empty;

    [Parameter]
    public string ErrorMessage { get; set; } = string.Empty;

    [Parameter]
    public string ValidationState { get; set; } = string.Empty; // "valid", "invalid", or empty

    [Parameter]
    public EventCallback<string> OnBlur { get; set; }

    private async Task HandleInput(ChangeEventArgs e)
    {
        var newValue = e.Value?.ToString() ?? string.Empty;
        await ValueChanged.InvokeAsync(newValue);
    }

    private async Task HandleBlur()
    {
        if (OnBlur.HasDelegate)
        {
            await OnBlur.InvokeAsync(Value);
        }
    }

    private string GetInputClass()
    {
        var baseClass = "floating-label-input";
        
        if (!string.IsNullOrEmpty(ErrorMessage))
        {
            return $"{baseClass} is-invalid";
        }
        
        if (ValidationState == "valid")
        {
            return $"{baseClass} is-valid";
        }

        return baseClass;
    }
}
