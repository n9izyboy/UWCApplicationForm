@page "/career-results"
@using UWCApplicationForm.Models
@using UWCApplicationForm.Services
@using UWCApplicationForm.Components
@using UWCApplicationForm.Layout
@inject NavigationManager Navigation
@inject CareerGuidanceStateService StateService

<PageTitle>Your Career Recommendations</PageTitle>

<!-- Header -->
<HeaderSection 
    ApplicantName="@StateService.CurrentProfile?.StudentName"
    ShowCloseButton="false"
    OnDarkModeChanged="HandleDarkModeChanged" />

<div class="container mx-auto px-4 py-8 max-w-7xl">
    
    @if (StateService.CurrentRecommendation == null)
    {
        <!-- No Data -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-12 text-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto mb-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h2 class="text-2xl font-bold text-gray-700 dark:text-gray-300 mb-4">No Assessment Data Found</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Please complete the career assessment first.</p>
            <button 
                @onclick='() => Navigation.NavigateTo("/career-guidance")'
                class="btn-primary px-8 py-3">
                Start Assessment
            </button>
        </div>
    }
    else
    {
        var recommendation = StateService.CurrentRecommendation;
        var profile = StateService.CurrentProfile!;

        <!-- Success Header -->
        <div class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg p-8 mb-8 text-white text-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h1 class="text-3xl md:text-4xl font-bold mb-2">ðŸŽ‰ Your Personalized Career Report is Ready!</h1>
            <p class="text-xl">Based on your academic performance and interests</p>
        </div>

        <!-- Student Summary -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-uwc-navy dark:text-uwc-gold mb-6">ðŸ“Š Your Academic Summary</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900 dark:to-blue-800 rounded-lg">
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-1">Overall Average</p>
                    <p class="text-4xl font-bold text-blue-600 dark:text-blue-200">@profile.OverallAverage.ToString("F1")%</p>
                    <p class="text-sm font-semibold text-blue-700 dark:text-blue-300 mt-1">@recommendation.PerformanceLevel</p>
                </div>
                
                <div class="text-center p-4 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900 dark:to-green-800 rounded-lg">
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-1">Total Subjects</p>
                    <p class="text-4xl font-bold text-green-600 dark:text-green-200">@profile.Subjects.Count</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Assessed</p>
                </div>
                
                <div class="text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900 dark:to-purple-800 rounded-lg">
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-1">Top Careers</p>
                    <p class="text-4xl font-bold text-purple-600 dark:text-purple-200">@recommendation.RecommendedCareers.Count</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Matched</p>
                </div>
                
                <div class="text-center p-4 bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900 dark:to-orange-800 rounded-lg">
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-1">Alternatives</p>
                    <p class="text-4xl font-bold text-orange-600 dark:text-orange-200">@recommendation.AlternativeCareers.Count</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Options</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Top Subjects -->
                <div>
                    <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-3 flex items-center gap-2">
                        ðŸŒŸ Your Strongest Subjects
                    </h3>
                    <div class="space-y-2">
                        @foreach (var subject in recommendation.TopSubjects)
                        {
                            <div class="p-3 bg-green-50 dark:bg-green-900 rounded-lg">
                                <p class="font-semibold text-green-800 dark:text-green-200">@subject</p>
                            </div>
                        }
                    </div>
                </div>

                <!-- Improvement Areas -->
                @if (recommendation.ImprovementAreas.Any())
                {
                    <div>
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200 mb-3 flex items-center gap-2">
                            ðŸ“š Areas for Improvement
                        </h3>
                        <div class="space-y-2">
                            @foreach (var area in recommendation.ImprovementAreas)
                            {
                                <div class="p-3 bg-yellow-50 dark:bg-yellow-900 rounded-lg">
                                    <p class="font-semibold text-yellow-800 dark:text-yellow-200">@area</p>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- General Recommendations -->
        @if (recommendation.GeneralRecommendations.Any())
        {
            <div class="bg-gradient-to-r from-uwc-navy to-blue-800 rounded-lg p-6 mb-8 text-white">
                <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    ðŸ’¬ Personal Recommendations for You
                </h2>
                <div class="space-y-3">
                    @foreach (var rec in recommendation.GeneralRecommendations)
                    {
                        <div class="flex items-start gap-3 p-4 bg-white bg-opacity-10 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0 text-uwc-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                            <p class="text-white">@rec</p>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Top Career Matches -->
        @if (recommendation.RecommendedCareers.Any())
        {
            <div class="mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-bold text-uwc-navy dark:text-uwc-gold flex items-center gap-3">
                        ðŸŽ¯ Your Top Career Matches
                        <span class="text-lg font-normal text-gray-600 dark:text-gray-400">(70%+ Match)</span>
                    </h2>
                </div>
                
                <div class="space-y-6">
                    @for (int i = 0; i < recommendation.RecommendedCareers.Count; i++)
                    {
                        var career = recommendation.RecommendedCareers[i];
                        <CareerCard Career="@career" InitiallyExpanded="@(i == 0)" />
                    }
                </div>
            </div>
        }

        <!-- Alternative Careers -->
        @if (recommendation.AlternativeCareers.Any())
        {
            <div class="mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-uwc-navy dark:text-uwc-gold flex items-center gap-3">
                        ðŸ”„ Alternative Career Options
                        <span class="text-lg font-normal text-gray-600 dark:text-gray-400">(50-69% Match)</span>
                    </h2>
                </div>
                
                <div class="space-y-6">
                    @foreach (var career in recommendation.AlternativeCareers)
                    {
                        <CareerCard Career="@career" InitiallyExpanded="false" />
                    }
                </div>
            </div>
        }

        <!-- Action Buttons -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 text-center">
            <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4">What's Next?</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Ready to take the next step in your career journey?</p>
            
            <div class="flex flex-wrap justify-center gap-4">
                <button 
                    @onclick="PrintResults"
                    class="btn-secondary px-6 py-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                    </svg>
                    Print / Save Report
                </button>
                
                <button 
                    @onclick='() => Navigation.NavigateTo("/career-guidance")'
                    class="btn-secondary px-6 py-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Start New Assessment
                </button>
                
                <button 
                    @onclick='() => Navigation.NavigateTo("/")'
                    class="btn-primary px-6 py-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                    </svg>
                    Apply to UWC
                </button>
            </div>
        </div>

        <!-- Footer Note -->
        <div class="mt-8 p-6 bg-blue-50 dark:bg-blue-900 rounded-lg border-l-4 border-blue-500">
            <p class="text-sm text-gray-700 dark:text-gray-300">
                <strong>Note:</strong> This career guidance is based on your current academic performance and stated interests. 
                Remember that with hard work and dedication, you can improve your marks and qualify for any career you're passionate about. 
                Your future is in your hands! ðŸš€
            </p>
        </div>
    }
</div>

@code {
    protected override void OnInitialized()
    {
        if (StateService.CurrentRecommendation == null)
        {
            // User navigated directly without completing assessment
            // The template will show the "no data" message
        }
    }

    private void PrintResults()
    {
        // Trigger browser print dialog
        // JavaScript interop could be added here if needed
    }

    private void HandleDarkModeChanged(bool isDarkMode)
    {
        if (Layout is MainLayout mainLayout)
        {
            mainLayout.SetDarkMode(isDarkMode);
        }
    }

    [CascadingParameter]
    public MainLayout? Layout { get; set; }
}
